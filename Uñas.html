<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda tu cita - UÃ±as by Karina</title>
</head>
<body>
  <img src="img/logo.png" alt="Logo principal" style="height: 60px;">
  <img src="img/aurum.png" alt="Logo proveedor" style="height: 60px;">
  <!-- CÃ³digo JS insertado desde canvas -->
  <script>
    let citas = [];
    let vendedorLogueado = false;

    function mostrarLogin() {
      const loginBox = document.getElementById('loginBox');
      loginBox.style.display = loginBox.style.display === 'none' ? 'block' : 'none';
    }

    function login() {
      const usuario = document.getElementById('usuario').value;
      const contrasena = document.getElementById('contrasena').value;
      const mensaje = document.getElementById('mensajeLogin');

      if (usuario === 'karina' && contrasena === '1234') {
        vendedorLogueado = true;
        document.getElementById('loginBox').style.display = 'none';
        mensaje.innerText = 'Inicio de sesiÃ³n exitoso';
        document.getElementById('panelAdmin').style.display = 'block';
        document.querySelector('.agenda-lista').style.display = 'block';
        renderCitas();

        // Mostrar botÃ³n de cerrar sesiÃ³n
        const cerrarSesionBtn = document.createElement('button');
        cerrarSesionBtn.innerText = 'Cerrar sesiÃ³n';
        cerrarSesionBtn.style.marginTop = '20px';
        cerrarSesionBtn.style.backgroundColor = '#bbb';
        cerrarSesionBtn.style.color = '#000';
        cerrarSesionBtn.style.border = 'none';
        cerrarSesionBtn.style.padding = '10px 20px';
        cerrarSesionBtn.style.borderRadius = '5px';
        cerrarSesionBtn.style.cursor = 'pointer';
        cerrarSesionBtn.onclick = () => cerrarSesion();
        document.getElementById('panelAdmin').appendChild(cerrarSesionBtn);
      } else {
        mensaje.innerText = 'Credenciales incorrectas';
      }
    }

    function agendarCita() {
      const nombre = document.getElementById('nombre').value;
      const telefono = document.getElementById('telefono').value;
      const servicio = document.getElementById('servicios').value;
      const fecha = document.getElementById('fecha').value;
      const hora = document.getElementById('hora').value;
      const limite = parseInt(document.getElementById('limiteCitas').value);
      const horaInicio = document.getElementById('horaInicio').value;
      const horaFin = document.getElementById('horaFin').value;

      if (!nombre || !telefono || !servicio || !fecha || !hora) {
        alert('Completa todos los campos.');
        return;
      }

      if ((horaInicio && hora < horaInicio) || (horaFin && hora > horaFin)) {
        alert('La hora seleccionada estÃ¡ fuera del horario permitido.');
        return;
      }

      const citasDelDia = citas.filter(c => c.fecha === fecha);
      if (!isNaN(limite) && citasDelDia.length >= limite) {
        alert('Ya se alcanzÃ³ el lÃ­mite de citas para este dÃ­a.');
        return;
      }

      const mensaje = `Hola Karina, te comparto una nueva cita agendada:%0A- Nombre del cliente: ${nombre}%0A- TelÃ©fono: ${telefono}%0A- Servicio: ${servicio}%0A- Fecha: ${fecha}%0A- Hora: ${hora}`;
      window.open(`https://wa.me/529991738710?text=${mensaje}`, '_blank');

      citas.push({ nombre, telefono, servicio, fecha, hora });
      renderCitas();
    }

    function renderCitas() {
      const lista = document.getElementById('lista-citas');
      if (!lista) return;
      lista.innerHTML = '';
      citas.forEach((cita, i) => {
        const li = document.createElement('li');
        li.innerHTML = `${cita.nombre} - ${cita.telefono} - ${cita.servicio} - ${cita.fecha} ${cita.hora}`;
        if (vendedorLogueado) {
          const btnEliminar = document.createElement('button');
          btnEliminar.innerText = 'Eliminar';
          btnEliminar.onclick = () => eliminarCita(i);
          li.appendChild(btnEliminar);

          const btnRecordatorio = document.createElement('button');
          btnRecordatorio.innerText = 'Recordatorio';
          btnRecordatorio.style.marginLeft = '5px';
          btnRecordatorio.onclick = () => enviarRecordatorio(cita);
          li.appendChild(btnRecordatorio);
        }
        lista.appendChild(li);
      });
    }

    function eliminarCita(index) {
      citas.splice(index, 1);
      renderCitas();
    }

    function cerrarSesion() {
      vendedorLogueado = false;
      document.getElementById('panelAdmin').style.display = 'none';
      document.querySelector('.agenda-lista').style.display = 'none';
      document.getElementById('mensajeLogin').innerText = '';
      mostrarLogin();
    }

    function enviarRecordatorio(cita) {
      const mensaje = `Hola ${cita.nombre}, este es un recordatorio de tu cita con Karina:%0A- Servicio: ${cita.servicio}%0A- Fecha: ${cita.fecha}%0A- Hora: ${cita.hora}`;
      window.open(`https://wa.me/52?text=${mensaje}`, '_blank');
    }
  </script>
</body>
</html>
